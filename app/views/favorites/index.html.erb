<!-- Banner -->
<div class="banner text-center">
  <h1 class="display-4 text-white">Your <span class="highlight">Favorites</span></h1>
  <p class="lead text-white">Browse your favorite trending topics from various platforms.</p>
</div>

<!-- Selectors / Filters -->
<div class="container">
  <%= form_with url: favorites_path(anchor: "results"), method: :get, local: true, class: "form-inline custom-form" do %>
    <div class="form-group">

      <%= select_tag :platform,
                     options_for_select([['TikTok', 'tiktok'], ['YouTube', 'youtube']],
                     selected: params[:platform]),
                     class: 'form-control custom-select',
                     onchange: 'this.form.submit();' %>
    </div>
    <% if params[:platform] == 'tiktok' %>
      <div class="form-group ml-3">
        <%= select_tag :tiktok_page,
                       options_for_select([['Hashtags', 'hashtag'],
                                           ['Keywords', 'keyword'],
                                           ['Products', 'product']],
                                           selected: params[:tiktok_page]),
                       class: 'form-control custom-select',
                       onchange: 'this.form.submit();' %>
      </div>
    <% end %>
  <% end %>
</div>

<!-- TikTok -->
<% if params[:platform] == 'tiktok' %>

  <!-- TikTok hashtags -->
  <% if @favorite_tiktok_hashtags.present? %>
  <!-- ADD HERE IF PLATFORM IS LIST -->
    <div class="container my-5">
      <h3>Your Favorite TikTok Hashtags</h3>
      <table class="table-custom">
        <thead>
          <tr>
            <th>#</th>
            <th>Hashtag</th>
            <th>Industry</th>
            <th>Posts</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @favorite_tiktok_hashtags.each_with_index do |trend, index| %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= trend.title %></td>
              <td><%= trend.industry.present? ? trend.industry : 'N/A' %></td>
              <td><%= trend.formatted_count(trend.count) %></td>
              <td>
                <%= link_to 'See analytics', trend_path(trend), class: 'btn btn-primary btn-sm mr-2 custom-btn-analytics' %>
                <%= button_to 'Remove',
                      favorite_remove_trend_path(favorite_id: current_user.favorite.id, trend_id: trend.id),
                      method: :delete,
                      class: 'btn btn-danger btn-sm custom-btn-remove' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
      <!-- ADD HERE IF PLATFORM IS DASHBOARD -->
        <%= column_chart @tiktok_data_graph_for_hashtags_count, height: "500px", colors: ["#3498db"] %>
        <h3>Last 7 days, all regions</h3>
        <%= column_chart @tiktok_data_graph_for_hashtags_count_overall, height: "500px", colors: ["#3498db"] %>
        <h3>Overall</h3>
  <% end %>

  <!-- TikTok keywords -->
  <% if @favorite_tiktok_keywords.present? %>
    <!-- ADD HERE IF PLATFORM IS LIST -->
    <div class="container my-5">
      <h3>Your Favorite TikTok Keywords</h3>
      <table class="table-custom">
        <thead>
          <tr>
            <th>#</th>
            <th>Keyword</th>
            <th>Impressions</th>
            <th>Likes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @favorite_tiktok_keywords.each_with_index do |trend, index| %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= trend.title %></td>
              <td><%= trend.formatted_count(trend.impression_count) if trend.impression_count.present? %></td>
              <td><%= trend.formatted_count(trend.like_count) if trend.like_count.present? %></td>
              <td>
                <%= link_to 'See analytics', trend_path(trend), class: 'btn btn-primary btn-sm mr-2 custom-btn-analytics' %>
                <%= button_to 'Remove',
                      favorite_remove_trend_path(favorite_id: current_user.favorite.id, trend_id: trend.id),
                      method: :delete,
                      class: 'btn btn-danger btn-sm custom-btn-remove' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <!-- ADD HERE IF PLATFORM IS DASHBOARD -->
      <!-- Bubble chart n°1 -->
      <div>
        <canvas id="bubbleChart1" width="400" height="400"></canvas>
        <h3>CTR vs CPA</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx1 = document.getElementById("bubbleChart1").getContext("2d");

          const data1 = {
            datasets: [{
              label: 'Keywords CTR vs CPA',
              data: <%= raw @bubble_chart_keyword_one.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options1 = {
            scales: {
              x: { title: { display: true, text: 'CTR (%)' }, beginAtZero: true },
              y: { title: { display: true, text: 'CPA ($)' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: CTR(${dataPoint.x}%), CPA(${dataPoint.y}$), Impressions(${dataPoint.r * 1000})`;
                  }
                }
              }
            }
          };

          new Chart(ctx1, { type: 'bubble', data: data1, options: options1 });
        });
      </script>

      <!-- Bubble chart n°2 -->
      <div>
        <canvas id="bubbleChart2" width="400" height="400"></canvas>
        <h3>Impressions vs CVR</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx2 = document.getElementById("bubbleChart2").getContext("2d");

          const data2 = {
            datasets: [{
              label: 'Keywords Impressions vs CVR',
              data: <%= raw @bubble_chart_keyword_two.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options2 = {
            scales: {
              x: { title: { display: true, text: 'Impressions' }, beginAtZero: true },
              y: { title: { display: true, text: 'CVR (%)' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: Impressions(${dataPoint.x}), CVR(${dataPoint.y}%), Cost(${dataPoint.r * 1000}$)`;
                  }
                }
              }
            }
          };

          new Chart(ctx2, { type: 'bubble', data: data2, options: options2 });
        });
      </script>

      <!-- Bubble chart n°3 -->
      <div>
        <canvas id="bubbleChart3" width="400" height="400"></canvas>
        <h3>Likes vs Shares</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx3 = document.getElementById("bubbleChart3").getContext("2d");

          const data3 = {
            datasets: [{
              label: 'Keywords Likes vs Shares',
              data: <%= raw @bubble_chart_keyword_three.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options3 = {
            scales: {
              x: { title: { display: true, text: 'Likes' }, beginAtZero: true },
              y: { title: { display: true, text: 'Shares' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: Likes(${dataPoint.x}), Shares(${dataPoint.y}), Comments(${dataPoint.r * 1000})`;
                  }
                }
              }
            }
          };

          new Chart(ctx3, { type: 'bubble', data: data3, options: options3 });
        });
      </script>

      <!-- All column charts -->
      <%= column_chart @tiktok_data_graph_for_keywords_popularity, height: "500px", colors: ["#3498db"] %>
      <h3>Popularity</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_popularity_change, height: "500px", colors: ["#3498db"] %>
      <h3>Popularity change</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_ctr, height: "500px", colors: ["#3498db"] %>
      <h3>CTR</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_cvr, height: "500px", colors: ["#3498db"] %>
      <h3>CVR</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_cpa, height: "500px", colors: ["#3498db"] %>
      <h3>CPA</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_cost, height: "500px", colors: ["#3498db"] %>
      <h3>Cost</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_impression_count, height: "500px", colors: ["#3498db"] %>
      <h3>Impression count</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_view_rate_6s, height: "500px", colors: ["#3498db"] %>
      <h3>View rate 6s</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_like_count, height: "500px", colors: ["#3498db"] %>
      <h3>Likes</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_share_count, height: "500px", colors: ["#3498db"] %>
      <h3>Shares</h3>
      <%= column_chart @tiktok_data_graph_for_keywords_comment_count, height: "500px", colors: ["#3498db"] %>
      <h3>Comments</h3>
  <% end %>

  <!-- TikTok products -->
  <% if @favorite_tiktok_products.present? %>
    <!-- ADD HERE IF PLATFORM IS LIST -->
    <div class="container my-5">
      <h3>Your Favorite TikTok Products</h3>
      <table class="table-custom">
        <thead>
          <tr>
            <th>Keyword</th>
            <th>Industry</th>
            <th>Impressions</th>
            <th>Likes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @favorite_tiktok_products.each_with_index do |trend, index| %>
            <tr>
              <td><%= trend.title %></td>
              <td><%= trend.industry.present? ? trend.industry : 'N/A' %></td>
              <td><%= trend.formatted_count(trend.impression_count) if trend.impression_count.present? %></td>
              <td><%= trend.formatted_count(trend.like_count) if trend.like_count.present? %></td>
              <td>
                <%= link_to 'See analytics', trend_path(trend), class: 'btn btn-primary btn-sm mr-2 custom-btn-analytics' %>
                <%= button_to 'Remove',
                      favorite_remove_trend_path(favorite_id: current_user.favorite.id, trend_id: trend.id),
                      method: :delete,
                      class: 'btn btn-danger btn-sm custom-btn-remove' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <!-- ADD HERE IF PLATFORM IS DASHBOARD -->
          <!-- Bubble chart n°1 -->
      <div>
        <canvas id="bubbleChart1" width="400" height="400"></canvas>
        <h3>CTR vs CPA</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx1 = document.getElementById("bubbleChart1").getContext("2d");

          const data1 = {
            datasets: [{
              label: 'Products CTR vs CPA',
              data: <%= raw @bubble_chart_product_one.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options1 = {
            scales: {
              x: { title: { display: true, text: 'CTR (%)' }, beginAtZero: true },
              y: { title: { display: true, text: 'CPA ($)' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: CTR(${dataPoint.x}%), CPA(${dataPoint.y}$), Impressions(${dataPoint.r * 1000})`;
                  }
                }
              }
            }
          };

          new Chart(ctx1, { type: 'bubble', data: data1, options: options1 });
        });
      </script>

      <!-- Bubble chart n°2 -->
      <div>
        <canvas id="bubbleChart2" width="400" height="400"></canvas>
        <h3>Impressions vs CVR</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx2 = document.getElementById("bubbleChart2").getContext("2d");

          const data2 = {
            datasets: [{
              label: 'Products Impressions vs CVR',
              data: <%= raw @bubble_chart_product_two.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options2 = {
            scales: {
              x: { title: { display: true, text: 'Impressions' }, beginAtZero: true },
              y: { title: { display: true, text: 'CVR (%)' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: Impressions(${dataPoint.x}), CVR(${dataPoint.y}%), Cost(${dataPoint.r * 1000}$)`;
                  }
                }
              }
            }
          };

          new Chart(ctx2, { type: 'bubble', data: data2, options: options2 });
        });
      </script>

      <!-- Bubble chart n°3 -->
      <div>
        <canvas id="bubbleChart3" width="400" height="400"></canvas>
        <h3>Likes vs Shares</h3>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx3 = document.getElementById("bubbleChart3").getContext("2d");

          const data3 = {
            datasets: [{
              label: 'Products Likes vs Shares',
              data: <%= raw @bubble_chart_keyword_three.to_json %>,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          };
          const options3 = {
            scales: {
              x: { title: { display: true, text: 'Likes' }, beginAtZero: true },
              y: { title: { display: true, text: 'Shares' }, beginAtZero: true }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dataPoint = context.raw;
                    return `${dataPoint.label}: Likes(${dataPoint.x}), Shares(${dataPoint.y}), Comments(${dataPoint.r * 1000})`;
                  }
                }
              }
            }
          };

          new Chart(ctx3, { type: 'bubble', data: data3, options: options3 });
        });
      </script>

      <%= column_chart @tiktok_data_graph_for_products_popularity, height: "500px", colors: ["#3498db"] %>
      <h3>Popularity</h3>
      <%= column_chart @tiktok_data_graph_for_products_popularity_change, height: "500px", colors: ["#3498db"] %>
      <h3>Popularity change</h3>
      <%= column_chart @tiktok_data_graph_for_products_ctr, height: "500px", colors: ["#3498db"] %>
      <h3>CTR</h3>
      <%= column_chart @tiktok_data_graph_for_products_cvr, height: "500px", colors: ["#3498db"] %>
      <h3>CVR</h3>
      <%= column_chart @tiktok_data_graph_for_products_cpa, height: "500px", colors: ["#3498db"] %>
      <h3>CPA</h3>
      <%= column_chart @tiktok_data_graph_for_products_cost, height: "500px", colors: ["#3498db"] %>
      <h3>Cost</h3>
      <%= column_chart @tiktok_data_graph_for_products_impression_count, height: "500px", colors: ["#3498db"] %>
      <h3>Impression count</h3>
      <%= column_chart @tiktok_data_graph_for_products_view_rate_6s, height: "500px", colors: ["#3498db"] %>
      <h3>View rate 6s</h3>
      <%= column_chart @tiktok_data_graph_for_products_like_count, height: "500px", colors: ["#3498db"] %>
      <h3>Likes</h3>
      <%= column_chart @tiktok_data_graph_for_products_share_count, height: "500px", colors: ["#3498db"] %>
      <h3>Shares</h3>
      <%= column_chart @tiktok_data_graph_for_products_comment_count, height: "500px", colors: ["#3498db"] %>
      <h3>Comments</h3>
  <% end %>

<!-- Youtube -->
<% elsif params[:platform] == 'youtube' %>
  <% if @favorite_youtube_trends.present? %>
    <!-- ADD HERE IF PLATFORM IS LIST -->
    <div class="container my-5">
      <h3>Your Favorite YouTube Trends</h3>
      <table class="table-custom">
        <thead>
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Views</th>
            <th>Likes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @favorite_youtube_trends.each_with_index do |trend, index| %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= trend.title %></td>
              <td><%= trend.formatted_count(trend.view_count) %></td>
              <td><%= trend.formatted_count(trend.like_count) %></td>
              <td>
                <%= link_to 'See analytics', trend_path(trend), class: 'btn btn-primary btn-sm mr-2 custom-btn-analytics' %>
                <%= button_to 'Remove',
                      favorite_remove_trend_path(favorite_id: current_user.favorite.id, trend_id: trend.id),
                      method: :delete,
                      class: 'btn btn-danger btn-sm custom-btn-remove' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <!-- ADD HERE IF PLATFORM IS DASHBOARD -->
  <% end %>

<!-- If no favorites -->
<% else %>
  <div class="container my-5">
    <h2>Uh-oh, your collection is feeling lonely! 😔</h2>
    <p>Time to fill it with some epic trends! 📈✨ Start exploring and improve your communication strategy! 🎉</p>
    <%= link_to 'Browse trends', trends_path, class: 'btn btn-primary' %>
  </div>
<% end %>




